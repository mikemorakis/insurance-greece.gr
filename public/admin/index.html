<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager | Insurance Greece</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="icon" href="/favicon.ico" sizes="any" />
</head>
<body>
  <script>
    // Check for pending auth token (from callback popup via localStorage)
    (function() {
      var token = localStorage.getItem("decap-cms-auth");
      if (token) {
        localStorage.removeItem("decap-cms-auth");
        localStorage.setItem("decap-cms-user", JSON.stringify({
          token: token,
          name: "",
          backendName: "github"
        }));
      }

      // Also listen for the storage event (fires when popup writes to localStorage)
      window.addEventListener("storage", function(e) {
        if (e.key === "decap-cms-auth" && e.newValue) {
          window.location.reload();
        }
      });

      // Replace Decap logo with Insurance Greece logo after CMS renders
      function replaceLogo() {
        var root = document.getElementById("nc-root");
        if (!root) return;

        var observer = new MutationObserver(function() {
          // Find and hide all SVGs on the login page (Decap logo)
          var svgs = root.querySelectorAll("svg");
          svgs.forEach(function(svg) {
            if (svg.closest("button")) return; // keep button icons
            svg.style.display = "none";
          });

          // Find the "Decap" text span and hide it
          var spans = root.querySelectorAll("span");
          spans.forEach(function(span) {
            if (span.textContent.trim() === "Decap") {
              span.parentElement.style.display = "none";
            }
          });

          // Add our logo if not already added
          if (!root.querySelector("#ig-logo")) {
            var loginBtn = root.querySelector("button[class*='LoginButton'], [class*='LoginButton']");
            if (!loginBtn) {
              // Try finding the GitHub login button
              var buttons = root.querySelectorAll("button");
              buttons.forEach(function(btn) {
                if (btn.textContent.indexOf("GitHub") !== -1) loginBtn = btn;
              });
            }
            if (loginBtn) {
              var logo = document.createElement("img");
              logo.id = "ig-logo";
              logo.src = "/images/insurance.greece.png";
              logo.alt = "Insurance Greece";
              logo.style.cssText = "display:block;width:300px;height:auto;margin:0 auto 2rem auto;";
              loginBtn.parentElement.insertBefore(logo, loginBtn);
            }
          }
        });

        observer.observe(root, { childList: true, subtree: true });
      }

      // Wait for CMS to create #nc-root
      var check = setInterval(function() {
        if (document.getElementById("nc-root")) {
          clearInterval(check);
          replaceLogo();
        }
      }, 200);
    })();
  </script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>
</html>
