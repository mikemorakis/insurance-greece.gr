---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---
<BaseLayout
  title={`${post.data.metaTitle || post.data.title} | Insurance Greece`}
  description={post.data.metaDesc || post.data.excerpt || ''}
  canonical={`/${post.slug}/`}
  ogType="article"
  ogImage={post.data.featuredImg}
  jsonLd={[
    { '@context': 'https://schema.org', '@type': 'BreadcrumbList', itemListElement: [
      { '@type': 'ListItem', position: 1, name: 'Home', item: 'https://insurance-greece.com/' },
      { '@type': 'ListItem', position: 2, name: 'Blog', item: 'https://insurance-greece.com/insurance-tips-in-greece/' },
      { '@type': 'ListItem', position: 3, name: post.data.title, item: `https://insurance-greece.com/${post.slug}/` },
    ]},
    { '@context': 'https://schema.org', '@type': 'BlogPosting', headline: post.data.title, description: post.data.excerpt || '', image: post.data.featuredImg, author: { '@type': 'Person', name: post.data.author }, datePublished: post.data.date.toISOString(), publisher: { '@type': 'Organization', name: 'Insurance Greece' } },
  ]}
>
  <section class="hero" style={post.data.featuredImg ? `background-image: linear-gradient(rgba(15,23,42,0.7), rgba(30,41,59,0.75)), url('${post.data.featuredImg}');` : ''}>
    <div class="container">
      <nav class="breadcrumb">
        <a href="/">Home</a> / <a href="/insurance-tips-in-greece/">Blog</a> / <span>{post.data.title}</span>
      </nav>
      <h1>{post.data.title}</h1>
      <div class="post-meta">
        <span>By {post.data.author}</span>
        <time datetime={post.data.date.toISOString()}>{post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
        {post.data.category && <span class="category">{post.data.category.replace(/-/g, ' ')}</span>}
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="article-grid">
        <article class="article-content">
          <Content />
        </article>

        <aside class="article-sidebar">
          <div class="widget">
            <h3>Get a Free Quote</h3>
            <p>Need insurance in Greece? Get a personalized quote today.</p>
            <a href="/contact-us/" class="btn btn-primary" style="width: 100%;">Contact Us</a>
          </div>
          <div class="widget">
            <h3>Questions?</h3>
            <p>Call: <a href="tel:+306936842241">+30 6936842241</a></p>
            <p>Email: <a href="mailto:info@insurance-greece.com">info@insurance-greece.com</a></p>
          </div>
        </aside>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
.hero { background: var(--brand-dark) center/cover no-repeat; color: var(--white); padding: var(--spacing-16) 0; text-align: center; }
.hero h1 { font-size: var(--font-size-4xl); margin-bottom: var(--spacing-4); color: var(--white); max-width: 800px; margin-left: auto; margin-right: auto; }
.breadcrumb { font-size: var(--font-size-sm); margin-bottom: var(--spacing-6); }
.breadcrumb a { color: var(--gray-300); }
.breadcrumb span { color: var(--white); }
.post-meta { display: flex; gap: var(--spacing-4); justify-content: center; font-size: var(--font-size-sm); color: var(--gray-300); }
.category { background: var(--brand-orange); color: var(--white); padding: var(--spacing-1) var(--spacing-3); border-radius: var(--radius-full); text-transform: capitalize; }
.article-grid { display: grid; grid-template-columns: 1fr 350px; gap: var(--spacing-12); }
.article-content { max-width: 100%; }
.article-content :global(h2) { margin-top: var(--spacing-8); margin-bottom: var(--spacing-4); }
.article-content :global(p) { line-height: 1.8; color: var(--color-text-light); }
.article-content :global(img) { border-radius: var(--radius-lg); margin: var(--spacing-6) 0; }
.article-sidebar { position: sticky; top: 100px; height: fit-content; }
.widget { background: var(--color-background-alt); padding: var(--spacing-6); border-radius: var(--radius-xl); margin-bottom: var(--spacing-6); }
.widget h3 { font-size: var(--font-size-lg); margin-bottom: var(--spacing-3); }
.widget p { font-size: var(--font-size-sm); color: var(--color-text-light); margin-bottom: var(--spacing-4); }
.widget a { color: var(--color-primary); }
@media (max-width: 1024px) { .article-grid { grid-template-columns: 1fr; } .article-sidebar { position: static; } }
@media (max-width: 768px) { .hero { padding: var(--spacing-10) 0; } .hero h1 { font-size: var(--font-size-3xl); } }
</style>
